System.register(["path","@babel/template"],function(f){"use strict";var l,m;return{setters:[function(o){l=o.default},function(o){m=o.default}],execute:function(){f("default",x);function o(e,i,t=[]){if(e.isIdentifier(i)&&u.includes(i.name))return!0;if(e.isMemberExpression(i)){const{property:a}=i;if(e.isIdentifier(a)&&[...u,...t].includes(a.name))return!0}return!1}const u=["abortableAtom","atom","atomFamily","atomWithDefault","atomWithHash","atomWithImmer","atomWithInfiniteQuery","atomWithMachine","atomWithMutation","atomWithObservable","atomWithProxy","atomWithQuery","atomWithReducer","atomWithReset","atomWithSubscription","atomWithStorage","atomWithStore","freezeAtom","loadable","selectAtom","splitAtom"],h=m.default||m;function p({types:e},i){return{visitor:{ExportDefaultDeclaration(t,a){const{node:n}=t;if(e.isCallExpression(n.declaration)&&o(e,n.declaration.callee,i==null?void 0:i.customAtomNames)){const r=a.filename||"unknown";let s=l.basename(r,l.extname(r));s==="index"&&(s=l.basename(l.dirname(r)));const d=h(`
          const %%atomIdentifier%% = %%atom%%;
          export default %%atomIdentifier%%
          `)({atomIdentifier:e.identifier(s),atom:n.declaration});t.replaceWithMultiple(d)}},VariableDeclarator(t){e.isIdentifier(t.node.id)&&e.isCallExpression(t.node.init)&&o(e,t.node.init.callee,i==null?void 0:i.customAtomNames)&&t.parentPath.insertAfter(e.expressionStatement(e.assignmentExpression("=",e.memberExpression(e.identifier(t.node.id.name),e.identifier("debugLabel")),e.stringLiteral(t.node.id.name))))}}}}const c=m.default||m;function b({types:e},i){return{pre({opts:t}){if(!t.filename)throw new Error("Filename must be available")},visitor:{Program:{exit(t){const a=c(`
          globalThis.jotaiAtomCache = globalThis.jotaiAtomCache || {
            cache: new Map(),
            get(name, inst) { 
              if (this.cache.has(name)) {
                return this.cache.get(name)
              }
              this.cache.set(name, inst)
              return inst
            },
          }`)();t.unshiftContainer("body",a)}},ExportDefaultDeclaration(t,a){const{node:n}=t;if(e.isCallExpression(n.declaration)&&o(e,n.declaration.callee,i==null?void 0:i.customAtomNames)){const r=`${a.filename||"unknown"}/defaultExport`,s=c("export default globalThis.jotaiAtomCache.get(%%atomKey%%, %%atom%%)")({atomKey:e.stringLiteral(r),atom:n.declaration});t.replaceWith(s)}},VariableDeclarator(t,a){var n,r;if(e.isIdentifier(t.node.id)&&e.isCallExpression(t.node.init)&&o(e,t.node.init.callee,i==null?void 0:i.customAtomNames)&&(((n=t.parentPath.parentPath)==null?void 0:n.isProgram())||((r=t.parentPath.parentPath)==null?void 0:r.isExportNamedDeclaration()))){const s=`${a.filename||"unknown"}/${t.node.id.name}`,d=c("const %%atomIdentifier%% = globalThis.jotaiAtomCache.get(%%atomKey%%, %%atom%%)")({atomIdentifier:e.identifier(t.node.id.name),atomKey:e.stringLiteral(s),atom:t.node.init});t.parentPath.replaceWith(d)}}}}}function x(e,i){return{plugins:[[p,i],[b,i]]}}}}});
